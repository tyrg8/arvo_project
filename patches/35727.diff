commit a6657afab9ffb258b01b3d6e485a86328bf4d40e
Author: Yukihiro "Matz" Matsumoto <matz@ruby.or.jp>
Date:   Sun Jul 4 00:08:17 2021 +0900

    codegen.c: jump address should be generated by `gen_jmpdst()`.

diff --git a/mrbgems/mruby-compiler/core/codegen.c b/mrbgems/mruby-compiler/core/codegen.c
index 5ab2f6180..16488cf33 100644
--- a/mrbgems/mruby-compiler/core/codegen.c
+++ b/mrbgems/mruby-compiler/core/codegen.c
@@ -429,31 +429,29 @@ static uint32_t
 genjmp2(codegen_scope *s, mrb_code i, uint16_t a, uint32_t pc, int val)
 {
   uint32_t pos;
 
   if (!no_peephole(s) && !val) {
     struct mrb_insn_data data = mrb_last_insn(s);
 
     if (data.insn == OP_MOVE && data.a == a) {
       s->pc = s->lastpc;
       a = data.b;
     }
   }
 
   s->lastpc = s->pc;
   if (a > 0xff) {
     gen_B(s, OP_EXT1);
     gen_B(s, i);
     gen_S(s, a);
-    pos = s->pc;
-    gen_S(s, pc);
   }
   else {
     gen_B(s, i);
     gen_B(s, (uint8_t)a);
-    pos = s->pc;
-    gen_jmpdst(s, pc);
   }
+  pos = s->pc;
+  gen_jmpdst(s, pc);
   return pos;
 }
 
 #define genjmp2_0(s,i,a,val) genjmp2(s,i,a,JMPLINK_START,val)
